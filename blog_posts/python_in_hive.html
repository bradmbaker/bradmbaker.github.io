<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title> Mo</title>
        <link rel="stylesheet" href="../dist/css/bootstrap.css"  type="text/css"/>
        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script> 
          $(function() {
            $(".navbar-wrapper").load("../nav.html");
          });
        </script>
    </head>
    <body>
 <!-- nav bar ====== --> 
    <div class="navbar-wrapper"></div>

<div class="container">

    <div class="page-header">
          <h1>Running Python Scripts in Hive</h1>
          <p class="lead">Detecting CJK Characters in a text field<br> 
          </p>
    </div>
    <div class="page-text" >
       <h3> Why include python in Hive? </h3> 
       <p> Often times there is some operation you'd like to do when querying a large dataset that isn't a built in hive function. Or there may be some function that you want to run that would be tedious to write in SQL, but would be simple if you could use a scripting language. Fortunately, it is fairly simple to run a some script on your data on Hive. </p>

       
       <h3>Detecting CJK characters in a string</h3>
       <p> In hive, I am selecting data from a text field followed by any number of columns. The data is separated by tabs. For example:
         <pre><code>select text_column, unique_id, created_timestamp
from great_table; </code></pre>


Then I've wrote a little script to go through the first column and check if any of the characters in the string are Chinese, Japanese or Korean. Note that I'm reading the full lines in from the query and printing the whole line back out. The first column is now returning a 0 or 1 if there is a CJK character instead of a text string and the remaining columns are left untouched.

<pre><code>import sys
for line in sys.stdin:
  r_val = 0
  line = line.split('\t')
  line[0] = unicode(line[0],'utf-8',errors="replace")

  for i in range(len(line[0])):
    if (u'\u4e00' <= line[0][i] <= u'\u9fff' or 
    u'\u3400' <= line[0][i] <= u'\u4dff' or 
    u'\u20000' <= line[0][i] <= u'\u2a6df' or  
    u'\uf900' <= line[0][i] <= u'\ufaff' or 
    u'\u2f800' <= line[0][i] <= u'\u2fa1f' or 
    u'\uac00' <= line[0][i] <= u'\ud7af'):
      r_val = 1
      break
    else:
      r_val = 0

  line[0] = r_val
  returned_value = '\t'.join(str(i) for i in line)
  print returned_value
</pre></code>

Then the final step is to add the file and run the query.

<pre><code> add file file_path/has_cjk_characters.py;

select transform(text_column, unique_id, created_timestamp)
using has_cjk_characters.py 
as (has_cjk_characters, unique_id, created_timestamp)
from great_table;
</pre></code>

And Voila, there you have, a transformmed column. This shouldn't add any noticeable decline in performace by adding this beyond the select.


 </p>
</div>

        <script src="../dist/js/bootstrap.js"></script>
      
    </body>
</html>


